{"version":3,"file":"auth.service.js","sourceRoot":"","sources":["../../src/auth.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable } from \"@angular/core\";\nimport { Observable } from \"rxjs/Observable\";\nimport { Observer } from \"rxjs/Observer\";\n\ndeclare let gapi: any;\ndeclare let IN: any;\ndeclare let FB: any;\n\nexport interface IProvider {\n  clientId: string;\n  apiVersion?: string;\n}\n\nexport interface IProviders {\n  [provider: string]: IProvider;\n}\n\n@Injectable()\nexport class AuthService {\n  gauth: any;\n\n  login(provider: string): Observable<Object> {\n    return Observable.create(\n      (observer: Observer<Object>) => {\n        switch (provider) {\n          case \"google\":\n            if (typeof (this.gauth) == \"undefined\") {\n              this.gauth = gapi.auth2.getAuthInstance();\n            }\n            if (!this.gauth.isSignedIn.get()) {\n              this.gauth.signIn().then(() => {\n                localStorage.setItem('_login_provider', 'google');\n                observer.next(this._fetchGoogleUserDetails());\n                observer.complete();\n              });\n            } else {\n              localStorage.setItem('_login_provider', 'google');\n              observer.next(this._fetchGoogleUserDetails());\n              observer.complete();\n            }\n\n            break;\n          case \"facebook\":\n            FB.getLoginStatus((response: any) => {\n              if (response.status === \"connected\") {\n                FB.api('/me?fields=first_name,last_name,email,picture', (res: any) => {\n                  if (!res || res.error) {\n                    observer.error(res.error);\n                  } else {\n                    let userDetails = {\n                      first_name: res.first_name,\n                      last_name: res.last_name,\n                      email: res.email,\n                      uid: res.id,\n                      provider: \"facebook\",\n                      image: res.picture.data.url,\n                      token: response.authResponse.accessToken,\n                      idToken: '',\n                    }\n                    localStorage.setItem('_login_provider', 'facebook');\n                    observer.next(userDetails);\n                    observer.complete();\n                  }\n                });\n              }\n              else {\n                FB.login((response: any) => {\n                  if (response.status === \"connected\") {\n                    FB.api('/me?fields=first_name,last_name,email,picture', (res: any) => {\n                      if (!res || res.error) {\n                        observer.error(res.error);\n                      } else {\n                        let userDetails = {\n                          first_name: res.first_name,\n                          last_name: res.last_name,\n                          email: res.email,\n                          uid: res.id,\n                          provider: \"facebook\",\n                          image: res.picture.data.url,\n                          token: response.authResponse.accessToken,\n                          idToken: '',\n                        }\n                        localStorage.setItem('_login_provider', 'facebook');\n                        observer.next(userDetails);\n                        observer.complete();\n                      }\n                    });\n                  }\n                }, { scope: 'email' });\n              }\n            });\n            break;\n          case \"linkedin\":\n            IN.User.authorize(function() {\n              IN.API.Raw(\"/people/~:(id,first-name,last-name,email-address,picture-url)\").result(function(res: any) {\n                let userDetails = {\r\n                  first_name: res.firstName,\n                  last_name: res.lastName,\n                  email: res.emailAddress,\n                  uid: res.id,\n                  provider: \"linkedIN\",\n                  image: res.pictureUrl\r\n                };\n                localStorage.setItem('_login_provider', 'linkedin');\n                observer.next(userDetails);\n                observer.complete();\n              });\n            });\n            break;\n        }\n      }\n    )\n  }\n\n  logout(): Observable<boolean> {\n    let provider = localStorage.getItem(\"_login_provider\");\n    return Observable.create((observer: any) => {\n      switch (provider) {\n        case \"google\":\n          let gElement = document.getElementById(\"gSignout\");\n          if (typeof (gElement) != 'undefined' && gElement != null) {\n            gElement.remove();\n          }\n          let d = document, gSignout;\n          let ref: any = d.getElementsByTagName('script')[0];\n          gSignout = d.createElement('script');\n          gSignout.src = \"https://accounts.google.com/Logout\";\n          gSignout.type = \"text/javascript\";\n          gSignout.id = \"gSignout\";\n          localStorage.removeItem('_login_provider');\n          observer.next(true);\n          observer.complete();\n          ref.parentNode.insertBefore(gSignout, ref);\n          break;\n        case \"facebook\":\n          FB.logout(function(res: any) {\n            localStorage.removeItem('_login_provider');\n            observer.next(true);\n            observer.complete();\n          });\n          break;\n        case \"linkedin\":\n          IN.User.logout(function() {\n            localStorage.removeItem('_login_provider');\n            observer.next(true);\n            observer.complete();\n          }, {});\n          break;\n      }\n    })\n  }\n\n  private _fetchGoogleUserDetails() {\n    let currentUser = this.gauth.currentUser.get();\n    let profile = currentUser.getBasicProfile();\n    let idToken = currentUser.getAuthResponse().id_token;\n    let accessToken = currentUser.getAuthResponse().access_token;\n\n    return {\n      token: accessToken,\n      idToken: idToken,\n      uid: profile.getId(),\n      first_name: profile.getGivenName(),\n      last_name: profile.getFamilyName(),\n      email: profile.getEmail(),\n      image: profile.getImageUrl(),\n      provider: \"google\"\n    };\n  }\n}\n"]}